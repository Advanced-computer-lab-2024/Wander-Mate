<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Bookings | Wander-Mate</title>
  <link rel="stylesheet" href="../styles/register.css" />
</head>
<body>
  <div class="wrapper">
    <div class="title">My Bookings</div>

    <!-- Bookings section -->
    <div class="bookings">
      <h2>My Bookings</h2>
      <ul id="bookingList">
        <!-- Bookings will be populated here -->
      </ul>
    </div>
  </div>

  <script>


    async function fetchTouristID() {
      const username = sessionStorage.getItem("username"); // Retrieve the username from session storage
      if (!username) {
        console.error("No username found in session storage.");
        return; // Exit if no username is found
      }

      try {
        // Fetch the tourist ID using the /getid endpoint
        const response = await fetch(`http://localhost:8000/getID/${username}`);
        
        if (!response.ok) throw new Error("Failed to fetch tourist ID");

        const { touristID } = await response.json(); // Assuming response is in form { touristID: "..." }

        if (touristID) {
          // Fetch bookings using the retrieved touristID
          fetchBookings(touristID);
        } else {
          console.error("Tourist ID not found.");
          alert("Tourist not found. Please log in.");
        }
      } catch (error) {
        console.error("Error fetching tourist ID:", error);
        alert("Could not load tourist information.");
      }
    }

    async function fetchBookings(touristID) {
  try {
    const response = await fetch(`http://localhost:8000/getMyBookings/${touristID}`);
    console.log("Bookings response status:", response.status); // Log response status

    if (!response.ok) throw new Error("Failed to fetch bookings");

    const bookings = await response.json();
    console.log("Bookings data:", bookings); // Log fetched bookings data

    if (bookings.length === 0) {
      document.getElementById("bookingList").innerHTML = "<li>No bookings found.</li>";
    } else {
      const bookingList = document.getElementById("bookingList");
      bookingList.innerHTML = bookings.map((booking) => `
        <li>
          <strong>Booking ID:</strong> ${booking._id} <br>
          <strong>Item ID:</strong> ${booking.itemId} <br>
          <strong>Item Model:</strong> ${booking.itemModel} <br>
          <strong>Booked Date:</strong> ${new Date(booking.bookedDate).toLocaleDateString()} <br>
          <strong>Created At:</strong> ${new Date(booking.createdAt).toLocaleDateString()}
        </li>
      `).join("");
    }
  } catch (error) {
    console.error("Error fetching bookings:", error);
    alert("Could not load bookings.");
  }
}

  </script>
</body>
</html>
